# 中断和异常

早期的计算机只能串行执行程序，系统资源利用率低。为了解决这个问题，操作系统被发明，而且引入了中断机制，实现了多道程序并发执行。

**本质上发生中断就意味着需要操作系统的介入，开展管理工作。**

## 中断的概念以及作用

1. 当中断发生时，CPU立即进入**核心态**
2. 当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理
3. 对于不同的中断信号，会进行不同的处理

发生了中断就意味着需要操作系统的介入，开展管理工作。由于操作系统的管理工作需要使用到特权指令，因此CPU需要从用户态变为核心态。**中断**可以使得CPU从**用户态到核心态**，使操作系统获得计算机的控制权。有了中断才能实现多道程序的并发执行。

用户态->内核态切换：通过中断实现并且中断是唯一途径。

核心态->用户态切换：执行一个特权指令，将程序状态字PSW的标志位设置为用户态

## 中断的分类

![](img\中断分类.png)

### 内中断（异常）

信号来源于CPU内部与当前执行的指令有关，分为自愿中断和强迫中断。其中自愿中断也就是指令中断，比如说系统调用时使用的房管指令。强迫中断分为硬件故障（缺页）以及软件中断（整数除0）

1. 陷阱、陷入trap:**有意而为之**的异常比如说**系统调用**
2. 故障fault：有**错误条件**引起的，可能被故障处理程序修复比如**说缺页**
3. 终止abort：**不可恢复的致命错误**造成的结果终止处理程序不再将控制返回给引发终止的应用程序比**如说整数除零**

### 外中断

外中断是侠义的中断，分为外设请求（IO操作完成发出的中断信号）和人工干预（用户强行终止一个进程）

## 外中断的处理过程

1. 执行完每个指令之后，CPU都需要**检查当前是否有外部中断信号**
2. 如果检测到了外部中断信号，则需要**保护被中断进程的CPU环**境（比如说PSW、程序计数器PC、各种通用寄存器）
3. 根据中断信号类型**转入相应的中断处理程序**
4. 恢复原进程的CPU环境并退出中断，**返回源程序继续往下执行**